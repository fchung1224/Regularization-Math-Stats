---
title: "Data Simulation"
author: "Lucas Leiter"
date: "3/8/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
```


```{r}
set.seed(43)

n<-5000
p<-500
#x<-matrix(runif(n*p,min=-100,max=100),ncol=p, nrow =n )
x<-runif(n,min=-1,max=1)
x
df<-data.frame(x)
df<-df%>%
  mutate(x_2 = x^2)%>%
  mutate(x_3 = x^3)%>%
  mutate(x_4 = x^4)%>%
  mutate(x_5 = x^5)%>%
  mutate(x_6=x^6)%>%
  mutate(x_7=x^7)%>%
  mutate(x_8=x^8)%>%
  mutate(x_9=x^9)%>%
  mutate(x_10=x^10)%>%
  mutate(x_11=x^11)%>%
  mutate(x_12=x^12)%>%
  mutate(x_13=x^13)

```

```{r}
truebetas<-c(4.868, -4.343, 0, 0.152,  1.533,0, -9.356, -7.131, -1.056, 8.862, -7.694,0, 1.016)

truebetas<-c(4.868, -4.343, 0, 0.152,  0,0,0,0,0,0,0,0,0)

x<-data.matrix(df)
```

```{r}
y<-x%*%truebetas

```


```{r}
df<-data.frame(y,x)

# Added Noise
df<-df%>% 
  mutate(y = y+rnorm(1, mean = 0, sd = 10))
df
```



```{r}
library(caret)
head(df)
```

# OLS
```{r}
set.seed(45)
ols_model<-train(
  y~.,
  data=df, 
  method="lm",
  trControl = trainControl(method = "cv", number = 10)
  
)
summary(ols_model)

```


```{r}
ols_model$results
```

```{r}
ols_model$resample%>%
  summarize(cv_mae=mean(MAE))
```
# Ridge
```{r}
lambda_grid<-10^seq(-3,1,length=300)
# Set the seed
set.seed(253)

# Perform Ridge
ridge_model <- train(
  y~.,
  data = df,
  method = "glmnet",
  trControl = trainControl(method = "cv", number = 10, selectionFunction = "oneSE"),
  tuneGrid = data.frame(alpha = 0, lambda = lambda_grid),
  metric = "MAE",
  na.action = na.omit
)


```


```{r}
# Plot coefficients for each Ridge
plot(ridge_model$finalModel, xvar = "lambda", label = TRUE, col = rainbow(500))
```

```{r}
plot(ridge_model, xlim=c(0.1,0.3),ylim=c(0,0.4))
```

```{r}
ridge_model$resample
ridge_model$bestTune
```

# Ridge
```{r}
lambda_grid<-10^seq(-3,1,length=300)
# Set the seed
set.seed(253)

# Perform Ridge
ridge_model <- train(
  y~.,
  data = df,
  method = "glmnet",
  trControl = trainControl(method = "cv", number = 10, selectionFunction = "best"),
  tuneGrid = data.frame(alpha = 0, lambda = lambda_grid),
  metric = "MAE",
  na.action = na.omit
)

# for lasso, alpha=1

```


```{r}
# Plot coefficients for each Ridge
plot(ridge_model$finalModel, xvar = "lambda", label = TRUE, col = rainbow(500))
```

```{r}
plot(ridge_model, xlim=c(0.1,0.3),ylim=c(0,0.4))
```

```{r}
ridge_model$resample
ridge_model$bestTune
```




# Elastic Net
```{r}

alpha_grid<-10^seq(-3,0,length=50)

lambda_grid<-10^seq(-3,1,length=300)
# Set the seed
set.seed(253)

# Perform Elastic Net
ridge_model <- train(
  y~.,
  data = df,
  method = "glmnet",
  trControl = trainControl(method = "cv", number = 10, selectionFunction = "oneSE"),
  tuneGrid = data.frame(alpha=alpha_grid, lambda = lambda_grid),
  metric = "MAE",
  na.action = na.omit
)


```


```{r}
# Plot coefficients for each Ridge
plot(ridge_model$finalModel, xvar = "lambda", label = TRUE, col = rainbow(500))
```

```{r}
plot(ridge_model, xlim=c(0.1,0.3),ylim=c(0,0.4))
```

```{r}
ridge_model$resample
ridge_model$bestTune
```